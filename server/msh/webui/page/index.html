<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

		<!-- Bootstrap CSS -->
		<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

        <!-- Font CSS -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">

		<!-- jQuery first, then Popper.js, then Bootstrap JS, Handlebars -->
		<script src="https://code.jquery.com/jquery-3.4.0.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.1.2/handlebars.js"></script>

		<script src="/static/js/home.js"></script>

		<title>Home</title>
	</head>
	<body onload="carica()">
		<div class="container">
            <div class="mb-3 mt-3 text-center">
                <h1><img src="/static/image/hub.png" class="img-fluid" style="width: 200px; height: 200px">Home</h1>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <button class="btn btn-warning btn-lg btn-block" type="button" onclick="logout()">Logout</button>
                    </div>
                    <div class="col-md-6 mb-3">
                        <button class="btn btn-success btn-lg btn-block" type="button" onclick="update()">Aggiorna a Ultima Versione</button>
                    </div>
                </div>
            </div>
			<div class="mb-3 row">
				<div class="col-md-12">
					<form>
						<div class="row">
                            <div class="col-md-3 mb-3">
							    <div class="dropdown">
                                    <label for="device">Dispositivo</label>
						  		    <button class="btn btn-secondary btn-lg btn-block dropdown-toggle " type="button" data-toggle="dropdown" id="device" onclick="device_net_code()"></button>
									<ul class="dropdown-menu" id="drop_device">
                                    </ul>
                                </div>
                                <script id="drop_device-template" type="text/x-handlebars-template">
                                    {{#each this}}
                                        <li class="dropdown-item">{{net_code}}</li>
                                    {{/each}}
                                </script>
								<div class="invalid-feedback" id="chk_device">
									Il dispositivo &egrave un campo obbligatorio
								</div>
                            </div>
                            <div class="col-md-3 mb-3">
							    <div class="dropdown">
                                    <label for="device">Comando</label>
						  		    <button class="btn btn-secondary btn-lg btn-block dropdown-toggle " type="button" data-toggle="dropdown" id="command" onclick="net_device('command')"></button>
                                    <ul class="dropdown-menu" id="drop_command">
                                    </ul>
                                </div>
                                <script id="drop_command-template" type="text/x-handlebars-template">
                                    {{#each this}}
                                        <li class="dropdown-item">{{cmd_str}}</li>
                                    {{/each}}
                                </script>
								<div class="invalid-feedback" id="chk_command">
									Il comando &egrave un campo obbligatorio
								</div>
                            </div>
							<div class="col-md-3 mb-3">
								<label for="result">Esito</label>
								<input type="text" class="form-control" id="result" readonly>
							</div>
							<div class="col-md-3 mb-3">
								<label for="cmd_result">Esito Comando</label>
								<input type="text" class="form-control" id="cmd_result" readonly>
							</div>
							<button class="btn btn-primary btn-lg btn-block" type="button" onclick="net_cmd()">Invia</button>
						</div>
					</form>
				</div>
			</div>
			<div class="mb-3 row">
				<div class="col-md-12">
				    <form>
						<div class="row">
							<div class="col-md-3 mb-3">
								<label for="esito">Esito</label>
								<input type="text" class="form-control" id="esito" readonly>
							</div>
							<div class="col-md-3 mb-3">
								<label for="found">Trovati</label>
								<input type="text" class="form-control" id="found" readonly>
							</div>
							<div class="col-md-3 mb-3">
								<label for="new">Nuovi</label>
								<input type="text" class="form-control" id="new" readonly>
							</div>
							<div class="col-md-3 mb-3">
								<label for="update">Aggiornati</label>
								<input type="text" class="form-control" id="update" readonly>
							</div>
							<button class="btn btn-primary btn-lg btn-block" type="button" onclick="net_scan()">Net Scan</button>
						</div>
				    </form>
				</div>
		    </div>
			<div class="mb-3 row">
				<div class="col-md-12">
					<div class="row">
						<button class="mb-3 btn btn-primary btn-lg btn-block" type="button" onclick="net_device('list')">List Device</button>
					</div>
                    <h5 id="errore" class="text-center d-none"></h5>
					<div  id="table-device" class="table-responsive"></div>
                    <script id="table-device-template" type="text/x-handlebars-template">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Codice</th>
                                    <th>Tipo</th>
                                    <th>Stato</th>
                                    <th>IP</th>
                                    <th>MAC</th>
                                    <th>MAC info</th>
                                    {{#if_eq user_role "ADMIN"}}
                                        <th>User SSH</th>
                                        <th>Password SSH</th>
                                    {{/if_eq}}
                                    <th>Ultimo aggiornamento</th>
                                    {{#if_eq user_role "ADMIN"}}
                                        <th>Salvataggio</th>
                                        <th>Reset</th>
                                        <th>Elimina</th>
                                    {{/if_eq}}
                                </tr>
                            </thead>
                            <tbody>
                                {{#each devices}}
                                    <tr>
                                        <td>
                                            <input class="form-control" style="width: auto" type="text" id="code{{@index}}" value="{{net_code}}">
                                        </td>
                                        <td>
                                            <div class="dropdown{{@index}}">
                                                <button class="btn btn-secondary btn-lg btn-block dropdown-toggle " type="button" data-toggle="dropdown" id="type{{@index}}" onclick="net_device('type{{@index}}')" value="{{net_type}}">{{net_type}}</button>
                                                <ul class="dropdown-menu" id="drop_type{{@index}}"></ul>
                                            </div>
                                        </td>
                                        <td>{{net_status}}</td>
                                        <td>{{net_ip}}</td>
                                        <td>
                                            <span id="mac{{@index}}">{{net_mac}}</span>
                                        </td>
                                        <td>{{net_mac_info}}</td>
                                        {{#if_eq ../user_role "ADMIN"}}
                                            <td>
                                                <input class="form-control" style="width: auto" type="text" id="usr{{@index}}" value="{{net_usr}}">
                                            </td>
                                            <td>
                                                <div class="input-group" style="width: 230px">
                                                    <input class="form-control" id="psw{{@index}}" value="{{net_psw}}" type="password">
                                                    <div class="input-group-append">
                                                        <button class="btn btn-primary input-group-button" onclick="view_password({{@index}})">
                                                            <i id="psw_icon{{@index}}" class="fa fa-eye-slash" aria-hidden="true"></i>
                                                        </button>
                                                    </div>
                                                </div>
                                            </td>
                                        {{/if_eq}}
                                        <td>{{net_last_update}}</td>
                                        {{#if_eq ../user_role "ADMIN"}}
                                            <td>
                                                <button disabled class="btn btn-primary btn-lg btn-block" type="button" id="salva{{@index}}" onclick="net_device('update{{@index}}')">Salva</button>
                                            </td>
                                            <td>
                                                <button disabled class="btn btn-primary btn-lg btn-block" type="button" id="reset{{@index}}" onclick="net_reset('{{@index}}')">Reset</button>
                                            </td>
                                            <td>
                                                <button class="btn btn-danger btn-lg btn-block" type="button" id="delete{{@index}}" onclick="net_device('delete{{@index}}')">Elimina</button>
                                            </td>
                                        {{/if_eq}}
                                    </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </script>
                    <script id="drop_type-template" type="text/x-handlebars-template">
                        {{#each this}}
                            <li class="dropdown-item">{{type_code}}</li>
                        {{/each}}
                    </script>
				</div>
		    </div>
            <div class="mb-3 row">
                <div class="col-md-12">
                    <div class="row">
						<button class="mb-3 btn btn-primary btn-lg btn-block" type="button" onclick="user_function('list')">List User</button>
                    </div>
                    <h5 id="errore_user" class="text-center d-none"></h5>
					<div  id="table-user" class="table-responsive"></div>
                    <script id="table-user-template" type="text/x-handlebars-template">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Username</th>
                                    <th>Password</th>
                                    <th>Ruolo</th>
                                    <th>Salva</th>
                                    <th>Reset</th>
                                    {{#if_eq user_role "ADMIN"}}
                                        <th>Elimina</th>
                                    {{/if_eq}}
                                </tr>
                            </thead>
                            <tbody>
                                {{#each users}}
                                    <tr>
                                        <td>
                                            <span id="username{{@index}}">{{username}}</span>
                                        </td>
                                        <td>
                                            <div class="input-group" style="width: 230px">
                                                <input class="form-control" id="psw_user{{@index}}" value="{{password}}" type="password">
                                                <div class="input-group-append">
                                                    <button class="btn btn-primary input-group-button" onclick="view_password_user({{@index}})">
                                                        <i id="psw_icon_user{{@index}}" class="fa fa-eye-slash" aria-hidden="true"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="dropdown{{@index}}">
                                                <button class="btn btn-secondary btn-lg btn-block dropdown-toggle " type="button" data-toggle="dropdown" id="role_user{{@index}}" value="{{role}}">{{role}}</button>
                                                <ul class="dropdown-menu">
                                                    <li class="dropdown-item" onclick="user_role('{{@index}}', 'ADMIN')">ADMIN</li>
                                                    <li class="dropdown-item" onclick="user_role('{{@index}}', 'USER')">USER</li>
                                                </ul>
                                            </div>
                                        </td>
                                        <td>
                                            <button disabled class="btn btn-primary btn-lg btn-block" type="button" id="salva_user{{@index}}" onclick="user_function('update{{@index}}')">Salva</button>
                                        </td>
                                        <td>
                                            <button disabled class="btn btn-primary btn-lg btn-block" type="button" id="reset_user{{@index}}" onclick="user_reset('{{@index}}')">Reset</button>
                                        </td>
                                        {{#if_eq ../user_role "ADMIN"}}
                                            <td>
                                                <button class="btn btn-danger btn-lg btn-block" type="button" id="delete_user{{@index}}" onclick="user_function('delete{{@index}}')">Elimina</button>
                                            </td>
                                        {{/if_eq}}
                                    </tr>
                                {{/each}}
                            </tbody>
                        </table>
                    </script>
                </div>
            </div>
            <div class="row mb-3 d-none" id="add-user">
                <div class="col-md-12">
                    <form>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="username_add">Username</label>
                                <input type="text" class="form-control" id="username_add">
                                <div class="invalid-feedback" id="chk_username">
                                    L username &egrave un campo obbligatorio
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="password_add">Password</label>
                                <input type="text" class="form-control" id="password_add">
                                <div class="invalid-feedback" id="chk_password">
                                    La password &egrave un campo obbligatorio
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="dropdown_add">
                                    <label for="role_user_add">Ruolo</label>
                                    <button class="btn btn-secondary btn-lg btn-block dropdown-toggle " type="button" data-toggle="dropdown" id="role_user_add"></button>
                                    <ul class="dropdown-menu">
                                        <li class="dropdown-item" onclick="user_role('add', 'ADMIN')">ADMIN</li>
                                        <li class="dropdown-item" onclick="user_role('add', 'USER')">USER</li>
                                    </ul>
                                </div>
                                <div class="invalid-feedback" id="chk_role">
                                    Il ruolo &egrave un campo obbligatorio
                                </div>
                            </div>
                            <button class="btn btn-primary btn-lg btn-block" type="button" onclick="user_function('add')">Add User</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="row mb-3 d-none" id="upload-arduino">
                <div class="col-md-12">
                    <form>
                        <div class="row">
                            <div class="col-md-4 mb-3">
							    <div class="dropdown">
                                    <label for="device_arduino">Dispositivo</label>
						  		    <button class="btn btn-secondary btn-lg btn-block dropdown-toggle " type="button" data-toggle="dropdown" id="device_arduino" onclick="upload_arduino('core')"></button>
									<ul class="dropdown-menu" id="drop_device_arduino">
                                    </ul>
                                </div>
                                <script id="drop_device_arduino-template" type="text/x-handlebars-template">
                                    {{#each this}}
                                        <li class="dropdown-item">{{this}}</li>
                                    {{/each}}
                                </script>
								<div class="invalid-feedback" id="chk_device_arduino">
									Il dispositivo &egrave un campo obbligatorio
								</div>
                            </div>
                            <div class="col-md-4 mb-3">
							    <div class="dropdown">
                                    <label for="tipo_arduino">Tipologia</label>
						  		    <button class="btn btn-secondary btn-lg btn-block dropdown-toggle " type="button" data-toggle="dropdown" id="tipo_arduino" onclick="upload_arduino('tipo')"></button>
									<ul class="dropdown-menu" id="drop_tipo_arduino">
                                    </ul>
                                </div>
                                <script id="drop_tipo_arduino-template" type="text/x-handlebars-template">
                                    {{#each this}}
                                        <li class="dropdown-item">{{this}}</li>
                                    {{/each}}
                                </script>
								<div class="invalid-feedback" id="chk_tipo_arduino">
									La tipologia &egrave un campo obbligatorio
								</div>
                            </div>
                            <div class="col-md-4 mb-3">
								<label for="esito_upload">Esito</label>
								<input type="text" class="form-control" id="esito_upload" readonly>
							</div>
                            <button class="btn btn-primary btn-lg btn-block" type="button" onclick="upload_arduino('upload')">Load</button>
                        </div>
                    </form>
                </div>
		    </div>
        </div>
	</body>
</html>
